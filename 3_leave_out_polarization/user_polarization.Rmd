---
title: "user_polarization"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      root.dir = '/Users/ddemszky/Google_Drive/Research/Framing/NAACL/framing-twitter')
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:
```{r}
library(ggplot2)
library(ggrepel)
library(RColorBrewer)
library("knitr")      # for knitting RMarkdown 
library("tidyverse")  # for wrangling, plotting, etc. 
library("lme4")

```

```{r}
data <- read.csv("../data/tweets/user_polarization.csv",header=TRUE)
pol <- read.csv("../data/output/polarization_over_time.csv",header=TRUE)
```

```{r}
day = 24 * 60 * 60
```

```{r}
data = data %>% 
  filter(first_timestamp > 0,
         event != 'fort_lauderdale') %>% 
  mutate(log_first_ts = log(first_timestamp),
         log_avg_ts = log(avg_timestamp),
         total_follows = dem_follows + rep_follows,
         follow_ratio = pmax(dem_follows, rep_follows) / total_follows,
         first_day = first_timestamp / day,
         avg_day = avg_timestamp / day)

data = data %>% 
  mutate_at(vars(leaveout_score, total_follows, avg_timestamp, first_timestamp, log_first_ts, log_avg_ts, follow_ratio, avg_day, first_day), funs(scaled=scale))
```


```{r}
ggplot(data, aes(x=total_follows, y=rep_follows)) +
  geom_smooth(method='lm', se=TRUE)
```


```{r}
lm(leaveout_score ~ dem_follows, data=data %>% filter(party == 'dem')) %>% summary() %>% print()
lm(leaveout_score ~ rep_follows, data=data %>% filter(party == 'rep')) %>% summary() %>% print()
mod.lmer_simp = lmer(follow_ratio_sc ~ (1 + total_follows|event), data=data)
mod.lmer = lmer(follow_ratio ~ total_follows + (1 + total_follows|event), data=data)
anova(mod.lmer, mod.lmer_simp) %>% print()
```



```{r}
mod.lmer_simp = lmer(leaveout_score ~ (1 + log_avg_ts|event), data=data)
mod.lmer = lmer(leaveout_score ~ log_avg_ts + (1 + log_avg_ts|event), data=data)
anova(mod.lmer, mod.lmer_simp) %>% print()

```




```{r}
mod.lm = lm(leaveout_score ~ avg_day, data=data)
mod.lm %>% summary() %>% print()
mod.lmer_simp = lmer(leaveout_score ~ (1 + avg_day|event), data=data)
mod.lmer = lmer(leaveout_score ~ avg_day + (1 + avg_day|event), data=data)
anova(mod.lmer, mod.lmer_simp) %>% print()

```




```{r}
mod.lm = lm(leaveout_score_scaled ~ total_follows_scaled, data=data)
mod.lm %>% summary() %>% print()
mod.lmer = lmer(leaveout_score_scaled ~ total_follows_scaled + (1|event), data=data)
mod.lmer_simp = lmer(leaveout_score_scaled ~ (1|event), data=data)
mod.lm %>% summary() %>% print()
mod.lmer %>% summary() %>% print()
anova(mod.lmer, mod.lmer_simp) %>% print()
```


```{r}
lm(total_follows_scaled ~ avg_timestamp_scaled, data=data) %>% 
  summary() %>% 
  print()

lm(total_follows_scaled ~ log_avg_ts_scaled, data=data) %>% 
  summary() %>% 
  print()

mod2.lmer = lmer(total_follows_scaled ~ avg_timestamp_scaled + (1|event), data=data)
mod2.lmer_simp = lmer(total_follows_scaled ~ (1|event), data=data)
anova(mod2.lmer, mod2.lmer_simp) %>% print()
```

```{r}
lm(leave ~ avg_timestamp_scaled, data=data) %>% 
  summary() %>% 
  print()

lm(total_follows_scaled ~ log_avg_ts_scaled, data=data) %>% 
  summary() %>% 
  print()

mod2.lmer = lmer(total_follows_scaled ~ avg_timestamp_scaled + (1|event), data=data)
mod2.lmer_simp = lmer(total_follows_scaled ~ (1|event), data=data)
anova(mod2.lmer, mod2.lmer_simp) %>% print()
```




```{r}
ggplot(data, aes(x=log_ts, y=leaveout_score)) + 
  geom_point(alpha=0.05) + 
  geom_smooth(method ="lm",
              se=TRUE) +
  facet_wrap(~event) +
  ylim(.5, .6)
```



```{r}
model <- lmer(leaveout_score ~ log_ts + (log_ts|event), data = data)

summary(data)

summary(model)
```



```{r}
data <- read.csv("../data/tweets/chattanooga/chattanooga_user_leaveout.csv",header=TRUE)
data = data %>% 
  mutate(log_ts = log(first_timestamp))
ggplot(data, aes(x=log_ts, y=leaveout_score)) + 
  geom_point(alpha=0.05) + 
  geom_smooth(method ="lm",
              se=TRUE) +
  ylim(.5, .6)
```

```{r}
data <- read.csv("../data/tweets/roseburg/roseburg_user_leaveout.csv",header=TRUE)
data = data %>% 
  mutate(log_ts = log(first_timestamp))
ggplot(data, aes(x=log_ts, y=leaveout_score)) + 
  geom_point(alpha=0.05) + 
  geom_smooth(method ="lm",
              se=TRUE) +
  ylim(.5, .6)
```
## Including Plots

You can also embed plots, for example:

```{r}
data <- read.csv("../data/tweets/colorado_springs/colorado_springs_user_leaveout.csv",header=TRUE)
data = data %>% 
  mutate(log_ts = log(first_timestamp))
ggplot(data, aes(x=log_ts, y=leaveout_score)) + 
  geom_point(alpha=0.05) + 
  geom_smooth(method ="lm",
              se=TRUE) +
  ylim(.5, .6)
```

```{r}
data <- read.csv("../data/tweets/san_bernardino/san_bernardino_user_leaveout.csv",header=TRUE)
data = data %>% 
  mutate(log_ts = log(first_timestamp))
ggplot(data, aes(x=log_ts, y=leaveout_score)) + 
  geom_point(alpha=0.05) + 
  geom_smooth(method ="lm",
              se=TRUE) +
  ylim(.5, .6)
```

```{r}
data <- read.csv("../data/tweets/kalamazoo/kalamazoo_user_leaveout.csv",header=TRUE)
data = data %>% 
  mutate(log_ts = log(first_timestamp))
ggplot(data, aes(x=log_ts, y=leaveout_score)) + 
  geom_point(alpha=0.05) + 
  geom_smooth(method ="lm",
              se=TRUE) +
  ylim(.5, .6)
```

```{r}
data <- read.csv("../data/tweets/orlando/orlando_user_leaveout.csv",header=TRUE)
data = data %>% 
  mutate(log_ts = log(first_timestamp))
ggplot(data, aes(x=log_ts, y=leaveout_score)) + 
  geom_point(alpha=0.05) + 
  geom_smooth(method ="lm",
              se=TRUE) +
  ylim(.5, .6)
```

```{r}
data <- read.csv("../data/tweets/dallas/dallas_user_leaveout.csv",header=TRUE)
data = data %>% 
  mutate(log_ts = log(first_timestamp))
ggplot(data, aes(x=log_ts, y=leaveout_score)) + 
  geom_point(alpha=0.05) + 
  geom_smooth(method ="lm",
              se=TRUE) +
  ylim(.5, .6)
```

```{r}
data <- read.csv("../data/tweets/baton_rouge/baton_rouge_user_leaveout.csv",header=TRUE)
data = data %>% 
  mutate(log_ts = log(first_timestamp))
ggplot(data, aes(x=log_ts, y=leaveout_score)) + 
  geom_point(alpha=0.05) + 
  geom_smooth(method ="lm",
              se=TRUE) +
  ylim(.5, .6)
```


```{r}
data <- read.csv("../data/tweets/burlington/burlington_user_leaveout.csv",header=TRUE)
data = data %>% 
  mutate(log_ts = log(first_timestamp))
ggplot(data, aes(x=log_ts, y=leaveout_score)) + 
  geom_point(alpha=0.05) + 
  geom_smooth(method ="lm",
              se=TRUE) +
  ylim(.5, .6)
```

```{r}

```

```{r}
data <- read.csv("../data/tweets/vegas/vegas_user_leaveout.csv",header=TRUE)
data = data %>% 
  mutate(log_ts = log(first_timestamp))
ggplot(data, aes(x=log_ts, y=leaveout_score, color=party)) + 
  geom_point(alpha=0.05) + 
  geom_smooth(method ="lm",
              se=TRUE)
```

